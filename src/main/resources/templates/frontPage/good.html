<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="publicPage/frontPage/header::html" ></head>
<body>
<div id="vueHook">
    <div th:replace="publicPage/frontPage/top::html" ></div>
    <div th:replace="publicPage/frontPage/search::html" ></div>
    <div th:replace="publicPage/frontPage/good/goodPage::html" ></div>
    <div th:replace="publicPage/frontPage/modal4login::html" ></div>
    <div th:replace="publicPage/frontPage/footer::html" ></div>
</div>
<script>
var vue = new Vue({
    el:"#vueHook",
    data(){
        return{
            result:[],
            good:"",
            category:null,
            shrinkImage:null,
            comments:[],
            attributeValues:[],
            showDetails:true,
            showComments:"",
            user:{
                name:"",
                password:""
            }
        }
    },
    mounted(){
        axios.get("froegood/" + getUrlParms("good_id"))
        .then( response => {
            // vue.result = response.data;
            vue.good = response.data.data.good;
            vue.attributeValues = response.data.data.attributeValues;
            vue.comments = response.data.data.comments;
            vue.category = vue.good.category;
            vue.shrinkImage = vue.good.shrinkImage;
            // vue.$nextTick(  () => {
            //     interaction();
            // })
            // vue.$nextTick(function(){
            //     imgAndInfoPageRegisterListeners(vue);
            // })
        }).catch( error => {
            console.log(error.message);
        });
    },
    methods:{
        tirggerDetail:function(){
            this.showComments = false;
            this.showDetails = true;
        },
        triggerComments:function(){
            this.showComments = true;
            this.showDetails = false;
        },
        setPurchaseAmount:function(){
            let stock = vue.good.stock
            // let amount = getPurchaseAmount();
            let amount = $(".productNumberSetting").val();
            if ( isNaN(amount) || amount <= 0 ){
                amount = 1;
            }
            if ( amount > stock ){
                amoutn = stock;
            }
            // checkStockBoundary(amount);
            // setPurchaseAmount(amount);
            $(".productNumberSetting").val(amount);
        },
        purchaseAmountUp:function(){
            // let amount = getPurchaseAmount();
            let amount = $(".productNumberSetting").val();
            amount++;
            if ( amount > stock ){
                amoutn = stock;
            }
            // checkStockBoundary(amount);
            // setPurchaseAmount(amount);
            $(".productNumberSetting").val(amount);
        },
        purchaseAmountDown:function(){
            // let amount = getPurchaseAmount();
            let amount = $(".productNumberSetting").val();
            --amount;
            if ( isNaN(amount) || amount <= 0 ){
                amount = 1;
            }
            // checkStockBoundary(amount);
            // setPurchaseAmount(amount);
            $(".productNumberSetting").val(amount);
        },
// 获取<input> 标签的属性的值 value 
getPurchaseAmount:function(){
    let amount = document.querySelector("productNumberSetting").value;
    return parseInt(amount);
},
// 设置<input> 标签的属性的值 value 
    setPurchaseAmount:function(amount){
        document.querySelector("productNumberSetting").value = amount;
    },
// 判断
checkStockBoundary:function(amount){
    if ( isNaN(amount) || amount <= 0 ){
        amount = 1;
    }
    if ( amount > stock ){
        amoutn = stock;
    }
    return amount;
},
        addCart:function(){
            axios.get("foreCheckLogin").then( response =>{
                if ( 0 === response.data.code ){
                    let good_id = vue.good.id;
                    let amount = getPurchaseAmount();
                    let url = "foreAddCart?good_id=" + good_id + "&amount=" + amount;
                    axios.get(url).then( response =>{
                        let result = response.data;
                        if ( 0 === result.code ){
                            $(".addCartButton").html("已加入购物车");
                            $(".addCartButton").attr("disabled","disabled");
                            $(".addCartButton").css("background-color","lightgray")
                            $(".addCartButton").css("border-color","lightgray")
                            $(".addCartButton").css("color","black")
                        }
                    }).catch( error =>{
                        console.log(error);
                    })
                }else{
                    // 如果没有登陆，弹出登录窗口
                    $("#loginModal").modal('show'); 
                }
            }).catch( error =>{
                console.log(error);
            });
        },
        buyImmediately:function(){
            axios.get("foreCheckLogin").then( response =>{
                if ( 0 === response.data.code ){
                    let good_id = vue.good.id;
                    let amount = getPurchaseAmount();
                    let url = "foreAddCart?good_id=" + good_id + "&amount=" + amount;
                    axios.get(url).then( response =>{
                        if ( 0 === response.data.code ){
                            let good_id = vue.good.id;
                            let amount = getPurchaseAmount();
                            let url = "foreAddCart?good_id=" + good_id + "&amount=" + amount;
                            axios.get(url).then( response =>{
                                let indentItem_id =  response.data;
                                location.href = "buy?indentItem_id=" + indentItem_id
                            }).catch( error =>{
                                console.log(error);
                            });
                        }else{
                            $("#loginModal").modal('show');
                        }
                    });
                }
            });
            return false;
        },
        login:function(){
                    if ( 0 === this.user.name.length ){
                        alert("请输入账户");
                        return;
                    }
                    if ( 0 === this.user.password.length ){
                        alert("请输入密码");
                        return;
                    }
                    axios.post("login",this.user).then( response => {
                        result = response.data;
                        if ( result.code === 0 ){
                            location.href = "good?good_id=" + vue.good.id;
                        }else{
                            alert(result.message);
                        }
                    }).catch( error => {
                        // console.log(error.message);
                        alert(error);
                    });
                }
    }
});




</script>
</body>
</html>